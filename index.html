<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Emoji Mall — Professional Marketplace (Standalone)</title>
<meta name="description" content="Standalone professional marketplace demo with theme switcher, global notice, search, filters, modal & lazy video.">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  /* ---------- Core / layout ---------- */
  :root{
    --bg: #f6f7fb;
    --panel: #fff;
    --muted: #6b7280;
    --text: #0f172a;
    --accent: #4f46e5;
    --card-shadow: 0 6px 22px rgba(12,18,33,0.06);
    --radius: 14px;
  }
  /* Theme variants will override CSS variables via [data-theme="..."] */
  html,body{height:100%}
  body{
    margin:0;
    min-height:100%;
    font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
    background:linear-gradient(180deg,var(--bg),#eef2ff 80%);
    color:var(--text);
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    padding:28px;
    box-sizing:border-box;
  }
  a{color:inherit}
  .container{max-width:1180px;margin:0 auto}
  header{
    display:flex;
    gap:16px;
    align-items:center;
    justify-content:space-between;
    margin-bottom:18px;
  }
  .brand{
    display:flex;gap:12px;align-items:center;
  }
  .logo{
    width:52px;height:52px;border-radius:12px;display:grid;place-items:center;font-weight:700;color:white;background:linear-gradient(135deg,var(--accent), #7c3aed);
    box-shadow:0 6px 20px rgba(0,0,0,0.08);
  }
  h1{font-size:20px;margin:0}
  .subtitle{color:var(--muted);font-size:13px;margin-top:2px}

  /* ---------- notice banner ---------- */
  .notice {
    display:flex;align-items:center;gap:12px;padding:12px;border-radius:12px;margin-bottom:16px;background:linear-gradient(90deg,rgba(255,250,205,0.95),rgba(255,245,235,0.95));
    border:1px solid rgba(0,0,0,0.04);
  }
  .notice.hidden{display:none}
  .notice .msg{flex:1;font-weight:600;color:#3b3b00}
  .notice .closeBtn{background:transparent;border:0;cursor:pointer;font-weight:700;color:var(--muted)}

  /* ---------- controls ---------- */
  .controls{
    display:flex;gap:12px;flex-wrap:wrap;align-items:center;margin-bottom:14px;
  }
  .search{
    flex:1;min-width:220px;display:flex;gap:8px;align-items:center;
    background:var(--panel);padding:8px;border-radius:12px;border:1px solid rgba(15,23,42,0.04);box-shadow:var(--card-shadow);
  }
  .search input{flex:1;border:0;background:transparent;outline:none;padding:8px;font-size:15px;color:var(--text)}
  .select, .theme-switch{padding:8px 12px;border-radius:10px;border:1px solid rgba(15,23,42,0.06);background:var(--panel);cursor:pointer}

  /* ---------- grid & cards ---------- */
  .grid{
    display:grid;
    gap:18px;
    grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
    margin-bottom:28px;
  }
  .card{
    --tilt-x:0;
    --tilt-y:0;
    transform:perspective(900px) rotateX(var(--tilt-x)) rotateY(var(--tilt-y)) translateZ(0);
    background:var(--panel);border-radius:12px;padding:16px;box-shadow:var(--card-shadow);cursor:pointer;transition:transform .22s ease,box-shadow .22s ease;
    display:flex;flex-direction:column;gap:10px;
  }
  .card:hover{box-shadow:0 12px 36px rgba(12,18,33,0.10);transform:translateY(-6px) scale(1.01)}
  .card .emoji{font-size:32px}
  .card h3{margin:0;font-size:16px}
  .card p{margin:0;color:var(--muted);font-size:13px}
  .badges{display:flex;gap:8px;flex-wrap:wrap}
  .badge{font-size:12px;padding:6px 8px;border-radius:999px;background:rgba(15,23,42,0.04);color:var(--muted)}

  /* ---------- modal ---------- */
  .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(7,11,20,0.6);z-index:9999;padding:20px}
  .modal.open{display:flex}
  .modal-card{background:var(--panel);max-width:820px;width:100%;border-radius:14px;padding:18px;box-shadow:0 30px 80px rgba(12,18,33,0.6);max-height:88vh;overflow:auto}
  .modal-head{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:8px}
  .modal-body{display:grid;grid-template-columns:1fr 320px;gap:18px}
  .modal-video iframe{width:100%;height:220px;border-radius:10px;border:0}
  .modal-info p{color:var(--muted);margin-top:8px}
  .modal-actions{display:flex;gap:8px;margin-top:12px;align-items:center}
  .btn{background:var(--accent);color:white;padding:10px 14px;border-radius:10px;border:0;cursor:pointer;font-weight:600}
  .btn.ghost{background:transparent;color:var(--accent);border:1px solid rgba(15,23,42,0.06)}

  /* responsive modal */
  @media (max-width:880px){
    .modal-body{grid-template-columns:1fr}
    .modal-video iframe{height:180px}
  }

  /* ---------- theme switcher row ---------- */
  .themes{display:flex;gap:8px;align-items:center}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Emoji Mall — Professional Marketplace (Standalone)</title>
<meta name="description" content="Standalone professional marketplace demo with theme switcher, global notice, search, filters, modal & lazy video.">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  /* ---------- Core / layout ---------- */
  :root{
    --bg: #f6f7fb;
    --panel: #fff;
    --muted: #6b7280;
    --text: #0f172a;
    --accent: #4f46e5;
    --card-shadow: 0 6px 22px rgba(12,18,33,0.06);
    --radius: 14px;
  }
  /* Theme variants will override CSS variables via [data-theme="..."] */
  html,body{height:100%}
  body{
    margin:0;
    min-height:100%;
    font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
    background:linear-gradient(180deg,var(--bg),#eef2ff 80%);
    color:var(--text);
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    padding:28px;
    box-sizing:border-box;
  }
  a{color:inherit}
  .container{max-width:1180px;margin:0 auto}
  header{
    display:flex;
    gap:16px;
    align-items:center;
    justify-content:space-between;
    margin-bottom:18px;
  }
  .brand{
    display:flex;gap:12px;align-items:center;
  }
  .logo{
    width:52px;height:52px;border-radius:12px;display:grid;place-items:center;font-weight:700;color:white;background:linear-gradient(135deg,var(--accent), #7c3aed);
    box-shadow:0 6px 20px rgba(0,0,0,0.08);
  }
  h1{font-size:20px;margin:0}
  .subtitle{color:var(--muted);font-size:13px;margin-top:2px}

  /* ---------- notice banner ---------- */
  .notice {
    display:flex;align-items:center;gap:12px;padding:12px;border-radius:12px;margin-bottom:16px;background:linear-gradient(90deg,rgba(255,250,205,0.95),rgba(255,245,235,0.95));
    border:1px solid rgba(0,0,0,0.04);
  }
  .notice.hidden{display:none}
  .notice .msg{flex:1;font-weight:600;color:#3b3b00}
  .notice .closeBtn{background:transparent;border:0;cursor:pointer;font-weight:700;color:var(--muted)}

  /* ---------- controls ---------- */
  .controls{
    display:flex;gap:12px;flex-wrap:wrap;align-items:center;margin-bottom:14px;
  }
  .search{
    flex:1;min-width:220px;display:flex;gap:8px;align-items:center;
    background:var(--panel);padding:8px;border-radius:12px;border:1px solid rgba(15,23,42,0.04);box-shadow:var(--card-shadow);
  }
  .search input{flex:1;border:0;background:transparent;outline:none;padding:8px;font-size:15px;color:var(--text)}
  .select, .theme-switch{padding:8px 12px;border-radius:10px;border:1px solid rgba(15,23,42,0.06);background:var(--panel);cursor:pointer}

  /* ---------- grid & cards ---------- */
  .grid{
    display:grid;
    gap:18px;
    grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
    margin-bottom:28px;
  }
  .card{
    --tilt-x:0;
    --tilt-y:0;
    transform:perspective(900px) rotateX(var(--tilt-x)) rotateY(var(--tilt-y)) translateZ(0);
    background:var(--panel);border-radius:12px;padding:16px;box-shadow:var(--card-shadow);cursor:pointer;transition:transform .22s ease,box-shadow .22s ease;
    display:flex;flex-direction:column;gap:10px;
  }
  .card:hover{box-shadow:0 12px 36px rgba(12,18,33,0.10);transform:translateY(-6px) scale(1.01)}
  .card .emoji{font-size:32px}
  .card h3{margin:0;font-size:16px}
  .card p{margin:0;color:var(--muted);font-size:13px}
  .badges{display:flex;gap:8px;flex-wrap:wrap}
  .badge{font-size:12px;padding:6px 8px;border-radius:999px;background:rgba(15,23,42,0.04);color:var(--muted)}

  /* ---------- modal ---------- */
  .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(7,11,20,0.6);z-index:9999;padding:20px}
  .modal.open{display:flex}
  .modal-card{background:var(--panel);max-width:820px;width:100%;border-radius:14px;padding:18px;box-shadow:0 30px 80px rgba(12,18,33,0.6);max-height:88vh;overflow:auto}
  .modal-head{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:8px}
  .modal-body{display:grid;grid-template-columns:1fr 320px;gap:18px}
  .modal-video iframe{width:100%;height:220px;border-radius:10px;border:0}
  .modal-info p{color:var(--muted);margin-top:8px}
  .modal-actions{display:flex;gap:8px;margin-top:12px;align-items:center}
  .btn{background:var(--accent);color:white;padding:10px 14px;border-radius:10px;border:0;cursor:pointer;font-weight:600}
  .btn.ghost{background:transparent;color:var(--accent);border:1px solid rgba(15,23,42,0.06)}

  /* responsive modal */
  @media (max-width:880px){
    .modal-body{grid-template-columns:1fr}
    .modal-video iframe{height:180px}
  }

  /* ---------- theme switcher row ---------- */
  .themes{display:flex;gap:8px;align-items:center}
  .theme-dot{width:36px;height:36px;border-radius:10px;cursor:pointer;border:2px solid rgba(255,255,255,0.04);display:inline-flex;align-items:center;justify-content:center;font-weight:700}

  /* ---------- footer ---------- */
  footer{text-align:center;color:var(--muted);font-size:13px;padding:28px 0}

  /* ---------- subtle helpers ---------- */
  .muted-text{color:var(--muted);font-size:13px}
  .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}

  /* ---------- THEME VARIANTS ---------- */
  /* Futuristic (neon dark) */
  [data-theme="futuristic"]{--bg:#06060a;--panel:linear-gradient(180deg,#061018,#071322);--muted:#9bd6c9;--text:#e6fff2;--accent:#00ff88;--card-shadow:0 10px 40px rgba(0,255,136,0.06)}
  [data-theme="minimal"]{--bg:#fbfbfd;--panel:#ffffff;--muted:#718096;--text:#0f172a;--accent:#334155;--card-shadow:0 6px 20px rgba(13,18,31,0.05)}
  [data-theme="organic"]{--bg:linear-gradient(180deg,#f7fff9,#eefaf3);--panel:#ffffff;--muted:#4b6b56;--text:#072017;--accent:#116530;--card-shadow:0 10px 30px rgba(6,56,28,0.06)}
  [data-theme="cinematic"]{--bg:#0b0b10;--panel:#0f1724;--muted:#9aa4b2;--text:#e8eef6;--accent:#ff6b6b;--card-shadow:0 18px 60px rgba(0,0,0,0.6)}
  [data-theme="celestial"]{--bg:linear-gradient(180deg,#02021a,#04103a);--panel:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));--muted:#a7c7ff;--text:#e8f3ff;--accent:#7dd3fc;--card-shadow:0 12px 48px rgba(125,211,252,0.06)}
  /* default theme */
  [data-theme="chameleon"]{--bg:#f6f7fb;--panel:#fff;--muted:#6b7280;--text:#0f172a;--accent:#4f46e5;--card-shadow:0 6px 22px rgba(12,18,33,0.06)}
</style>
</head>
<body data-theme="chameleon">
  <div class="container">

    <!-- header -->
    <header>
      <div class="brand">
        <div class="logo" aria-hidden>EM</div>
        <div>
          <h1>Emoji Mall — Marketplace</h1>
          <div class="subtitle">Discover & join curated communities and stores • demo standalone</div>
        </div>
      </div>

      <div style="display:flex;gap:12px;align-items:center">
        <div class="themes" title="Theme preview">
          <div class="theme-dot" style="background:linear-gradient(135deg,#4f46e5,#7c3aed)" data-theme="chameleon" aria-label="Chameleon"></div>
          <div class="theme-dot" style="background:linear-gradient(135deg,#00121a,#00334d)" data-theme="futuristic" aria-label="Futuristic"></div>
          <div class="theme-dot" style="background:linear-gradient(135deg,#fff7ed,#ffedd5)" data-theme="organic" aria-label="Organic"></div>
          <div class="theme-dot" style="background:linear-gradient(135deg,#ffffff,#f3f4f6)" data-theme="minimal" aria-label="Minimal"></div>
          <div class="theme-dot" style="background:linear-gradient(135deg,#0b1020,#2b334d)" data-theme="cinematic" aria-label="Cinematic"></div>
          <div class="theme-dot" style="background:linear-gradient(135deg,#021030,#073a6b)" data-theme="celestial" aria-label="Celestial"></div>
        </div>
      </div>
    </header>

    <!-- global notice (populated from /api/getNotice) -->
    <div id="globalNotice" class="notice hidden" role="region" aria-live="polite">
      <div class="msg" id="noticeMsg"></div>
      <button class="closeBtn" id="dismissNotice" title="Dismiss notice" aria-label="Dismiss notice">&times;</button>
    </div>

    <!-- controls -->
    <div class="controls">
      <div class="search" role="search" aria-label="Search stores">
        <svg width="18" height="18" viewbox="0 0 24 24" fill="none" style="opacity:.7"><path d="M21 21l-4.35-4.35" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"></path><circle cx="11" cy="11" r="6" stroke="currentColor" stroke-width="1.6"></circle></svg>
        <input id="searchInput" type="search" placeholder="Search stores, taglines, emojis..." />
      </div>

      <select id="categoryFilter" class="select" aria-label="Filter by category">
        <option value="all">All categories</option>
        <option value="shopping">🛍 Shopping</option>
        <option value="community">🤝 Community</option>
        <option value="entertainment">🎭 Entertainment</option>
        <option value="food">🍔 Food</option>
      </select>

      <select id="sortSelect" class="select" aria-label="Sort stores">
        <option value="featured">Sort: Featured</option>
        <option value="alpha">Sort: A → Z</option>
        <option value="new">Sort: Newest</option>
      </select>
    </div>

    <!-- store grid -->
    <main>
      <div id="storeGrid" class="grid" aria-live="polite"></div>
    </main>

    <footer>Emoji Mall • Demo • <span class="muted-text">Standalone</span></footer>
  </div>

  <!-- modal -->
  <div id="storeModal" class="modal" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal-card" role="document">
      <div class="modal-head">
        <div>
          <h2 id="modalTitle">Title</h2>
          <div class="muted-text" id="modalCategory">Category</div>
        </div>
        <div style="display:flex;gap:8px;align-items:center">
          <button id="prevStore" class="btn ghost">◀ Prev</button>
          <button id="nextStore" class="btn ghost">Next ▶</button>
          <button id="closeModal" class="btn">Close</button>
        </div>
      </div>
      <div class="modal-body">
        <div>
          <div id="modalVideo" class="modal-video" aria-hidden="true"></div>
          <div class="modal-info">
            <p id="modalTagline"></p>
            <div style="margin-top:10px" class="modal-actions">
              <a id="joinBtn" class="btn" target="_blank" rel="noopener">Join WhatsApp</a>
              <button id="copyLink" class="btn ghost">Copy Link</button>
            </div>
          </div>
        </div>

        <aside style="min-width:260px">
          <div style="background:var(--panel);padding:12px;border-radius:10px">
            <div style="font-size:13px;color:var(--muted)">Store details</div>
            <div id="details" style="margin-top:8px;font-size:14px;color:var(--text)"></div>
            <div style="margin-top:12px" class="muted-text">Tip: use ← → keys to navigate</div>
          </div>
        </aside>
      </div>
    </div>
  </div>

<script>
/* ===================== Demo stores data (replace with fetch('stores.json') if you keep external file) ===================== */
const demoStores = [
  { id:'s1', emoji:'🧸', name:'Toy Haven', tagline:'Handmade toys & plushies', category:'shopping', whatsapp_url:'https://wa.me/1234567890', video_url:'https://www.youtube.com/embed/ScMzIvxBSi4', featured: true, created: '2025-08-10' },
  { id:'s2', emoji:'☕', name:'Brew&Co', tagline:'Specialty coffee community', category:'food', whatsapp_url:'https://wa.me/1987654321', video_url:'', featured: false, created: '2025-09-01' },
  { id:'s3', emoji:'🎨', name:'Art Atelier', tagline:'Local crafts and prints', category:'community', whatsapp_url:'https://wa.me/15551234', video_url:'https://www.youtube.com/embed/dQw4w9WgXcQ', featured: true, created: '2025-01-05' },
  { id:'s4', emoji:'🎮', name:'Game Forge', tagline:'Indie devs & playtests', category:'entertainment', whatsapp_url:'https://wa.me/14445555', video_url:'', featured: false, created: '2025-07-21' },
  { id:'s5', emoji:'🌿', name:'Green Goods', tagline:'Sustainable home & gifts', category:'shopping', whatsapp_url:'https://wa.me/17778888', video_url:'', featured: false, created: '2025-06-12' },
  { id:'s6', emoji:'🎶', name:'Studio Jam', tagline:'Music collabs & sessions', category:'community', whatsapp_url:'https://wa.me/16669999', video_url:'https://www.youtube.com/embed/ScMzIvxBSi4', featured:false, created:'2025-03-02' }
];

/* ===================== App state ===================== */
let STORES = [];            // full dataset
let VISIBLE = [];           // filtered & sorted
let currentIndex = -1;      // index within VISIBLE (for modal nav)
const storeGrid = document.getElementById('storeGrid');
const modal = document.getElementById('storeModal');
const noticeEl = document.getElementById('globalNotice');
const noticeMsg = document.getElementById('noticeMsg');

/* ===================== Utilities ===================== */
function byId(id){return document.getElementById(id)}
function renderStores(list){
  storeGrid.innerHTML = '';
  if(!list.length){
    storeGrid.innerHTML = `<div style="grid-column:1/-1;padding:36px;border-radius:12px;background:var(--panel);text-align:center;color:var(--muted)">No stores found — try another search or category.</div>`;
    return;
  }
  const frag = document.createDocumentFragment();
  list.forEach((s, idx) => {
    const card = document.createElement('div');
    card.className = 'card';
    card.setAttribute('data-id', s.id);
    card.innerHTML = `
      <div style="display:flex;align-items:center;justify-content:space-between">
        <div style="display:flex;gap:12px;align-items:center">
          <div class="emoji">${s.emoji}</div>
          <div>
            <h3>${escapeHtml(s.name)}</h3>
            <p>${escapeHtml(s.tagline)}</p>
            <div class="badges">
              ${s.featured?'<span class="badge">⭐ Featured</span>':''}
              <span class="badge">${s.category}</span>
            </div>
          </div>
        </div>
      </div>`;
    // tilt effect
    enableTilt(card);
    card.addEventListener('click', ()=> openModalById(s.id));
    frag.appendChild(card);
  });
  storeGrid.appendChild(frag);
}

/* safe escaping */
function escapeHtml(str){
  return String(str).replace(/[&<>"']/g, (m)=> ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
}

/* enable tilt (subtle) */
function enableTilt(node){
  let rect, cx, cy, raf=0;
  function onMove(e){
    rect = node.getBoundingClientRect();
    cx = rect.left + rect.width/2;
    cy = rect.top + rect.height/2;
    const x = (e.clientX - cx) / (rect.width/2);
    const y = (e.clientY - cy) / (rect.height/2);
    cancelAnimationFrame(raf);
    raf = requestAnimationFrame(()=> {
      node.style.setProperty('--tilt-x', (y * -6).toFixed(2) + 'deg');
      node.style.setProperty('--tilt-y', (x * 6).toFixed(2) + 'deg');
    });
  }
  function reset(){ node.style.setProperty('--tilt-x','0'); node.style.setProperty('--tilt-y','0'); }
  node.addEventListener('mousemove', onMove);
  node.addEventListener('mouseleave', reset);
}

/* ===================== Modal functions ===================== */
function openModalById(id){
  const idx = VISIBLE.findIndex(s=>s.id===id);
  if(idx === -1) return;
  openModal(idx);
}
function openModal(idx){
  currentIndex = idx;
  const s = VISIBLE[idx];
  byId('modalTitle').innerText = `${s.emoji} ${s.name}`;
  byId('modalCategory').innerText = s.category;
  byId('modalTagline').innerText = s.tagline;
  byId('details').innerHTML = `
    <div><strong>Created:</strong> ${s.created}</div>
    <div style="margin-top:6px"><strong>ID:</strong> ${s.id}</div>
  `;
  const video = byId('modalVideo');
  video.innerHTML = s.video_url ? `<iframe data-src="${s.video_url}" src="" loading="lazy" title="${s.name} video" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"></iframe>` : '<div class="muted-text">No video preview</div>';
  const joinBtn = byId('joinBtn');
  joinBtn.href = s.whatsapp_url || '#';
  joinBtn.onclick = ()=> {
    // analytics stub - replace with real endpoint or Vercel Analytics event
    try{ if(window.navigator && navigator.sendBeacon) navigator.sendBeacon('/api/trackClick', JSON.stringify({id:s.id,ts:new Date().toISOString()})) }catch(e){}
  };
  byId('copyLink').onclick = ()=> {
    const url = s.whatsapp_url || window.location.href;
    navigator.clipboard?.writeText(url).then(()=>alert('Link copied'));
  };
  // open modal
  modal.classList.add('open');
  modal.setAttribute('aria-hidden','false');
  // lazy-load iframe src after short delay so open feels instant
  setTimeout(()=> {
    const iframe = video.querySelector('iframe[data-src]');
    if(iframe && !iframe.src) iframe.src = iframe.getAttribute('data-src');
  }, 220);
}

/* close modal */
function closeModal(){
  modal.classList.remove('open');
  modal.setAttribute('aria-hidden','true');
  // stop iframe autoplay (if any)
  const iframe = byId('modalVideo').querySelector('iframe');
  if(iframe) iframe.src = '';
}

/* prev/next */
byId('prevStore').addEventListener('click', ()=> { if(currentIndex>0) openModal(currentIndex-1);});
byId('nextStore').addEventListener('click', ()=> { if(currentIndex < VISIBLE.length-1) openModal(currentIndex+1);});
byId('closeModal').addEventListener('click', closeModal);
modal.addEventListener('click', (e)=> { if(e.target === modal) closeModal(); } );

/* keyboard nav */
window.addEventListener('keydown', (e)=>{
  if(modal.classList.contains('open')){
    if(e.key === 'Escape') closeModal();
    if(e.key === 'ArrowLeft') { if(currentIndex>0) openModal(currentIndex-1); }
    if(e.key === 'ArrowRight') { if(currentIndex < VISIBLE.length-1) openModal(currentIndex+1); }
  }
});

/* ===================== search/filter/sort ===================== */
function applyFilters(){
  const q = (byId('searchInput').value || '').trim().toLowerCase();
  const cat = byId('categoryFilter').value;
  const sort = byId('sortSelect').value;

  VISIBLE = STORES.filter(s => {
    const matchQ = q === '' || (s.name + ' ' + s.tagline + ' ' + s.emoji).toLowerCase().includes(q);
    const matchCat = cat === 'all' || s.category === cat;
    return matchQ && matchCat;
  });

  // sort
  if(sort === 'alpha') VISIBLE.sort((a,b)=> a.name.localeCompare(b.name));
  else if(sort === 'new') VISIBLE.sort((a,b)=> new Date(b.created) - new Date(a.created));
  else VISIBLE.sort((a,b)=> (b.featured?1:0) - (a.featured?1:0)); // featured first default

  renderStores(VISIBLE);
}

/* event listeners */
byId('searchInput').addEventListener('input', debounce(applyFilters, 180));
byId('categoryFilter').addEventListener('change', applyFilters);
byId('sortSelect').addEventListener('change', applyFilters);

/* theme switching (dots) */
document.querySelectorAll('.theme-dot').forEach(el=>{
  el.addEventListener('click', ()=> {
    const t = el.getAttribute('data-theme') || 'chameleon';
    document.body.setAttribute('data-theme', t);
    // small visual feedback
    el.animate([{transform:'scale(1.05)'},{transform:'scale(1)'}],{duration:180});
  });
});

/* ===================== global notice (auto refresh) ===================== */
let noticeDismissed = false;
async function loadNotice(){
  try{
    const r = await fetch('/api/getNotice');
    if(!r.ok) throw new Error('notice fetch failed');
    const data = await r.json();
    const text = (data.notice || data || '').toString().trim();
    if(text && !noticeDismissed){
      noticeMsg.innerText = '🔔 ' + text;
      noticeEl.classList.remove('hidden');
    } else {
      noticeEl.classList.add('hidden');
    }
  }catch(e){
    // silent fail — no notice available
    // console.warn('notice load', e);
  }
}
/* auto-refresh every 30s so announcements show up without page reload */
setInterval(loadNotice, 30000);
loadNotice();
byId('dismissNotice').addEventListener('click', ()=> {
  noticeDismissed = true; noticeEl.classList.add('hidden');
});

/* ===================== bootstrap data (demo) ===================== */
function initApp(){
  // In production, replace this with fetch('stores.json') and assign STORES = response
  STORES = demoStores.slice(); 
  applyFilters();
}
initApp();

/* ===================== utilities: debounce ===================== */
function debounce(fn, ms=120){let t;return (...a)=>{clearTimeout(t);t=setTimeout(()=>fn.apply(this,a),ms)}}
</script>
</body>
</html>￼Enter  .theme-dot{width:36px;height:36px;border-radius:10px;cursor:pointer;border:2px solid rgba(255,255,255,0.04);display:inline-flex;align-items:center;justify-content:center;font-weight:700}

  /* ---------- footer ---------- */
  footer{text-align:center;color:var(--muted);font-size:13px;padding:28px 0}

  /* ---------- subtle helpers ---------- */
  .muted-text{color:var(--muted);font-size:13px}
  .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}

  /* ---------- THEME VARIANTS ---------- */
  /* Futuristic (neon dark) */
  [data-theme="futuristic"]{--bg:#06060a;--panel:linear-gradient(180deg,#061018,#071322);--muted:#9bd6c9;--text:#e6fff2;--accent:#00ff88;--card-shadow:0 10px 40px rgba(0,255,136,0.06)}
  [data-theme="minimal"]{--bg:#fbfbfd;--panel:#ffffff;--muted:#718096;--text:#0f172a;--accent:#334155;--card-shadow:0 6px 20px rgba(13,18,31,0.05)}
  [data-theme="organic"]{--bg:linear-gradient(180deg,#f7fff9,#eefaf3);--panel:#ffffff;--muted:#4b6b56;--text:#072017;--accent:#116530;--card-shadow:0 10px 30px rgba(6,56,28,0.06)}
  [data-theme="cinematic"]{--bg:#0b0b10;--panel:#0f1724;--muted:#9aa4b2;--text:#e8eef6;--accent:#ff6b6b;--card-shadow:0 18px 60px rgba(0,0,0,0.6)}
  [data-theme="celestial"]{--bg:linear-gradient(180deg,#02021a,#04103a);--panel:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));--muted:#a7c7ff;--text:#e8f3ff;--accent:#7dd3fc;--card-shadow:0 12px 48px rgba(125,211,252,0.06)}
  /* default theme */
  [data-theme="chameleon"]{--bg:#f6f7fb;--panel:#fff;--muted:#6b7280;--text:#0f172a;--accent:#4f46e5;--card-shadow:0 6px 22px rgba(12,18,33,0.06)}
</style>
</head>
<body data-theme="chameleon">
  <div class="container">

    <!-- header -->
    <header>
      <div class="brand">
        <div class="logo" aria-hidden>EM</div>
        <div>
          <h1>Emoji Mall — Marketplace</h1>
          <div class="subtitle">Discover & join curated communities and stores • demo standalone</div>
        </div>
      </div>

      <div style="display:flex;gap:12px;align-items:center">
        <div class="themes" title="Theme preview">
          <div class="theme-dot" style="background:linear-gradient(135deg,#4f46e5,#7c3aed)" data-theme="chameleon" aria-label="Chameleon"></div>
          <div class="theme-dot" style="background:linear-gradient(135deg,#00121a,#00334d)" data-theme="futuristic" aria-label="Futuristic"></div>
          <div class="theme-dot" style="background:linear-gradient(135deg,#fff7ed,#ffedd5)" data-theme="organic" aria-label="Organic"></div>
          <div class="theme-dot" style="background:linear-gradient(135deg,#ffffff,#f3f4f6)" data-theme="minimal" aria-label="Minimal"></div>
          <div class="theme-dot" style="background:linear-gradient(135deg,#0b1020,#2b334d)" data-theme="cinematic" aria-label="Cinematic"></div>
          <div class="theme-dot" style="background:linear-gradient(135deg,#021030,#073a6b)" data-theme="celestial" aria-label="Celestial"></div>
        </div>
      </div>
    </header>

    <!-- global notice (populated from /api/getNotice) -->
    <div id="globalNotice" class="notice hidden" role="region" aria-live="polite">
      <div class="msg" id="noticeMsg"></div>
      <button class="closeBtn" id="dismissNotice" title="Dismiss notice" aria-label="Dismiss notice">&times;</button>
    </div>

    <!-- controls -->
    <div class="controls">
      <div class="search" role="search" aria-label="Search stores">
        <svg width="18" height="18" viewbox="0 0 24 24" fill="none" style="opacity:.7"><path d="M21 21l-4.35-4.35" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"></path><circle cx="11" cy="11" r="6" stroke="currentColor" stroke-width="1.6"></circle></svg>
        <input id="searchInput" type="search" placeholder="Search stores, taglines, emojis..." />
      </div>

      <select id="categoryFilter" class="select" aria-label="Filter by category">
        <option value="all">All categories</option>
        <option value="shopping">🛍 Shopping</option>
        <option value="community">🤝 Community</option>
        <option value="entertainment">🎭 Entertainment</option>
        <option value="food">🍔 Food</option>
      </select>

      <select id="sortSelect" class="select" aria-label="Sort stores">
        <option value="featured">Sort: Featured</option>
        <option value="alpha">Sort: A → Z</option>
        <option value="new">Sort: Newest</option>
      </select>
    </div>

    <!-- store grid -->
    <main>
      <div id="storeGrid" class="grid" aria-live="polite"></div>
    </main>

    <footer>Emoji Mall • Demo • <span class="muted-text">Standalone</span></footer>
  </div>

  <!-- modal -->
  <div id="storeModal" class="modal" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal-card" role="document">
      <div class="modal-head">
        <div>
          <h2 id="modalTitle">Title</h2>
          <div class="muted-text" id="modalCategory">Category</div>
        </div>
        <div style="display:flex;gap:8px;align-items:center">
          <button id="prevStore" class="btn ghost">◀ Prev</button>
          <button id="nextStore" class="btn ghost">Next ▶</button>
          <button id="closeModal" class="btn">Close</button>
        </div>
      </div>
      <div class="modal-body">
        <div>
          <div id="modalVideo" class="modal-video" aria-hidden="true"></div>
          <div class="modal-info">
            <p id="modalTagline"></p>
            <div style="margin-top:10px" class="modal-actions">
              <a id="joinBtn" class="btn" target="_blank" rel="noopener">Join WhatsApp</a>
              <button id="copyLink" class="btn ghost">Copy Link</button>
            </div>
          </div>
        </div>

        <aside style="min-width:260px">
          <div style="background:var(--panel);padding:12px;border-radius:10px">
            <div style="font-size:13px;color:var(--muted)">Store details</div>
            <div id="details" style="margin-top:8px;font-size:14px;color:var(--text)"></div>
      <div style="margin-top:12px" class="muted-text">Tip: use ← → keys to navigate</div>
          </div>
        </aside>
      </div>
    </div>
  </div>

<script>
/* ===================== Demo stores data (replace with fetch('stores.json') if you keep external file) ===================== */
const demoStores = [
  { id:'s1', emoji:'🧸', name:'Toy Haven', tagline:'Handmade toys & plushies', category:'shopping', whatsapp_url:'https://wa.me/1234567890', video_url:'https://www.youtube.com/embed/ScMzIvxBSi4', featured: true, created: '2025-08-10' },
  { id:'s2', emoji:'☕', name:'Brew&Co', tagline:'Specialty coffee community', category:'food', whatsapp_url:'https://wa.me/1987654321', video_url:'', featured: false, created: '2025-09-01' },
  { id:'s3', emoji:'🎨', name:'Art Atelier', tagline:'Local crafts and prints', category:'community', whatsapp_url:'https://wa.me/15551234', video_url:'https://www.youtube.com/embed/dQw4w9WgXcQ', featured: true, created: '2025-01-05' },
  { id:'s4', emoji:'🎮', name:'Game Forge', tagline:'Indie devs & playtests', category:'entertainment', whatsapp_url:'https://wa.me/14445555', video_url:'', featured: false, created: '2025-07-21' },
  { id:'s5', emoji:'🌿', name:'Green Goods', tagline:'Sustainable home & gifts', category:'shopping', whatsapp_url:'https://wa.me/17778888', video_url:'', featured: false, created: '2025-06-12' },
  { id:'s6', emoji:'🎶', name:'Studio Jam', tagline:'Music collabs & sessions', category:'community', whatsapp_url:'https://wa.me/16669999', video_url:'https://www.youtube.com/embed/ScMzIvxBSi4', featured:false, created:'2025-03-02' }
];

/* ===================== App state ===================== */
let STORES = [];            // full dataset
let VISIBLE = [];           // filtered & sorted
let currentIndex = -1;      // index within VISIBLE (for modal nav)
const storeGrid = document.getElementById('storeGrid');
const modal = document.getElementById('storeModal');
const noticeEl = document.getElementById('globalNotice');
const noticeMsg = document.getElementById('noticeMsg');

/* ===================== Utilities ===================== */
function byId(id){return document.getElementById(id)}
function renderStores(list){
  storeGrid.innerHTML = '';
  if(!list.length){
    storeGrid.innerHTML = `<div style="grid-column:1/-1;padding:36px;border-radius:12px;background:var(--panel);text-align:center;color:var(--muted)">No stores found — try another search or category.</div>`;
    return;
  }
  const frag = document.createDocumentFragment();
  list.forEach((s, idx) => {
    const card = document.createElement('div');
    card.className = 'card';
    card.setAttribute('data-id', s.id);
    card.innerHTML = `
      <div style="display:flex;align-items:center;justify-content:space-between">
        <div style="display:flex;gap:12px;align-items:center">
          <div class="emoji">${s.emoji}</div>
          <div>
            <h3>${escapeHtml(s.name)}</h3>
            <p>${escapeHtml(s.tagline)}</p>
            <div class="badges">
              ${s.featured?'<span class="badge">⭐ Featured</span>':''}
              <span class="badge">${s.category}</span>
            </div>
          </div>
        </div>
      </div>`;
    // tilt effect
    enableTilt(card);
    card.addEventListener('click', ()=> openModalById(s.id));
    frag.appendChild(card);
  });
  storeGrid.appendChild(frag);
}

/* safe escaping */
function escapeHtml(str){
  return String(str).replace(/[&<>"']/g, (m)=> ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
}

/* enable tilt (subtle) */
function enableTilt(node){
  let rect, cx, cy, raf=0;
  function onMove(e){
    rect = node.getBoundingClientRect();
    cx = rect.left + rect.width/2;
    cy = rect.top + rect.height/2;
    const x = (e.clientX - cx) / (rect.width/2);
    const y = (e.clientY - cy) / (rect.height/2);
    cancelAnimationFrame(raf);
    raf = requestAnimationFrame(()=> {
      node.style.setProperty('--tilt-x', (y * -6).toFixed(2) + 'deg');
      node.style.setProperty('--tilt-y', (x * 6).toFixed(2) + 'deg');
    });
  }
  function reset(){ node.style.setProperty('--tilt-x','0'); node.style.setProperty('--tilt-y','0'); }
  node.addEventListener('mousemove', onMove);
  node.addEventListener('mouseleave', reset);
}

/* ===================== Modal functions ===================== */
function openModalById(id){
  const idx = VISIBLE.findIndex(s=>s.id===id);
  if(idx === -1) return;
  openModal(idx);
}
function openModal(idx){
  currentIndex = idx;
  const s = VISIBLE[idx];
  byId('modalTitle').innerText = `${s.emoji} ${s.name}`;
  byId('modalCategory').innerText = s.category;
  byId('modalTagline').innerText = s.tagline;
  byId('details').innerHTML = `
    <div><strong>Created:</strong> ${s.created}</div>
    <div style="margin-top:6px"><strong>ID:</strong> ${s.id}</div>
  `;
  const video = byId('modalVideo');
  video.innerHTML = s.video_url ? `<iframe data-src="${s.video_url}" src="" loading="lazy" title="${s.name} video" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"></iframe>` : '<div class="muted-text">No video preview</div>';
  const joinBtn = byId('joinBtn');
  joinBtn.href = s.whatsapp_url || '#';
  joinBtn.onclick = ()=> {
    // analytics stub - replace with real endpoint or Vercel Analytics event
    try{ if(window.navigator && navigator.sendBeacon) navigator.sendBeacon('/api/trackClick', JSON.stringify({id:s.id,ts:new Date().toISOString()})) }catch(e){}
  };
